{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} — {{ config.name }} Blog{% endblock %}
{% block meta_description %}{{ post.description or post.excerpt }}{% endblock %}

{% block head_extra %}
    <link rel="canonical" href="{{ canonical_url }}">
    {% set social_description = (post.description or post.excerpt) %}
    {% set hero_path = post.hero_image and url_for('static', filename=post.hero_image) %}
    {% if hero_path %}
        {% if config.site_url %}
            {% set social_image = config.site_url ~ hero_path %}
        {% else %}
            {% set social_image = hero_path %}
        {% endif %}
    {% else %}
        {% set default_image_path = url_for('static', filename='images/SreyeeshProfilePic.jpg') %}
        {% if config.site_url %}
            {% set social_image = config.site_url ~ default_image_path %}
        {% else %}
            {% set social_image = default_image_path %}
        {% endif %}
    {% endif %}

    <meta property="og:type" content="article">
    <meta property="og:site_name" content="{{ config.name }}">
    <meta property="og:title" content="{{ post.title }}">
    {% if social_description %}
        <meta property="og:description" content="{{ social_description }}">
    {% endif %}
    <meta property="og:url" content="{{ canonical_url }}">
    {% if social_image %}
        <meta property="og:image" content="{{ social_image }}">
    {% endif %}

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ post.title }}">
    {% if social_description %}
        <meta name="twitter:description" content="{{ social_description }}">
    {% endif %}
    {% if social_image %}
        <meta name="twitter:image" content="{{ social_image }}">
    {% endif %}
{% endblock %}

{% block content %}
<article class="blog-post">
    <header class="blog-post-header">
        <p class="blog-post-date">{{ post.date_display }} • {{ post.reading_time }} min read</p>
        <h1>{{ post.title }}</h1>
    </header>

    {% if post.hero_image %}
        <figure class="blog-post-hero">
            <img src="{{ url_for('static', filename=post.hero_image) }}" alt="" loading="lazy">
        </figure>
    {% endif %}

    <div class="blog-post-body">
        {{ post.content | safe }}
    </div>

    <footer class="blog-post-footer">
        <a class="back-to-blog" href="{{ blog_index_href }}">← Back to all posts</a>
    </footer>
</article>

<aside class="blog-related">
    <h2>More to explore</h2>
    <ul>
        {% set related = (posts | selectattr('slug', 'ne', post.slug) | list)[:3] %}
        {% if related %}
            {% for other in related %}
                <li>
                    <a href="{{ blog_index_href }}{{ other.slug }}/">
                        <span class="related-title">{{ other.title }}</span>
                        <span class="related-meta">{{ other.date_display }} • {{ other.reading_time }} min read</span>
                    </a>
                </li>
            {% endfor %}
        {% else %}
            <li>No other posts yet.</li>
        {% endif %}
    </ul>
</aside>
{% endblock %}
