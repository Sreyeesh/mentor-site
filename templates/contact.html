{% extends 'base.html' %}

{% block head_extra %}
    {{ super() }}
    <link rel="preconnect" href="https://assets.calendly.com" crossorigin>
    <link rel="dns-prefetch" href="https://assets.calendly.com">
    <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css">
{% endblock %}

{% block title %}Book a Call | {{ config.name }}{% endblock %}
{% block meta_description %}Get in touch to book a 30-minute strategy call or request workshops for your school or studio.{% endblock %}

{% block content %}
<section class="page-hero">
    <p class="section-eyebrow">Contact</p>
    <h1>Book a free 30-minute strategy call.</h1>
    <p class="lead">Share your goals and current work. We’ll map a mentoring sprint, workshop plan, or collaboration outline.</p>
</section>

<section class="section contact-section">
    <div class="contact-grid">
        <div class="contact-card">
            <h2>How to reach out</h2>
            <ul class="contact-list">
                <li><strong>Email:</strong> <a href="mailto:{{ config.email }}">{{ config.email }}</a></li>
                <li><strong>Calendly:</strong> <a href="{{ config.calendly_link }}" target="_blank" rel="noopener">Book a slot</a></li>
                <li><strong>Location:</strong> Remote from Estonia & Finland time zones</li>
            </ul>
            <p>Expect a reply within 24 hours with a quick questionnaire so we can focus the call.</p>
        </div>
        <div class="contact-card">
            <h2>Booking widget</h2>
            <div class="booking-placeholder">
                <!-- Calendly inline widget begin -->
                <div id="calendly-inline-widget" class="calendly-inline-widget" aria-live="polite" aria-busy="true"
                    style="min-width:320px;height:700px;">
                    <p class="calendly-loading">Loading available sessions…</p>
                </div>
                <noscript class="calendly-noscript">
                    Calendly requires JavaScript to display the booking form. You can still <a href="{{ config.calendly_link }}"
                        target="_blank" rel="noopener">book a slot directly on Calendly</a>.
                </noscript>
                <!-- Calendly inline widget end -->
            </div>
        </div>
    </div>
</section>

<section class="section final-cta">
    <div class="final-cta-card">
        <p class="section-eyebrow">Need workshops instead?</p>
        <h2>Schools and studios can request tailored sessions.</h2>
        <a href="{{ site_links.schools }}" class="cta-button secondary">See Workshops</a>
    </div>
</section>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('calendly-inline-widget');
            if (!container) {
                return;
            }

            const calendlyUrl = {{ config.calendly_link | tojson }};
            const scriptSelector = 'script[data-calendly-widget]';

            const initializeWidget = () => {
                if (!window.Calendly || typeof window.Calendly.initInlineWidget !== 'function') {
                    return;
                }

                window.Calendly.initInlineWidget({
                    url: calendlyUrl,
                    parentElement: container,
                });
                container.removeAttribute('aria-busy');
            };

            const existingScript = document.querySelector(scriptSelector);
            if (existingScript) {
                if (existingScript.dataset.loaded === 'true') {
                    initializeWidget();
                } else {
                    existingScript.addEventListener('load', initializeWidget, { once: true });
                }
                return;
            }

            const calendlyScript = document.createElement('script');
            calendlyScript.src = 'https://assets.calendly.com/assets/external/widget.js';
            calendlyScript.async = true;
            calendlyScript.dataset.calendlyWidget = 'true';
            calendlyScript.addEventListener('load', () => {
                calendlyScript.dataset.loaded = 'true';
                initializeWidget();
            }, { once: true });
            calendlyScript.addEventListener('error', () => {
                container.setAttribute('data-calendly-error', 'load_failed');
            });

            document.head.appendChild(calendlyScript);
        });
    </script>
{% endblock %}
